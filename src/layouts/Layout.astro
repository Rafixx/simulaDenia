---
import "../styles/global.css";
import { useTranslations } from "../utils/languageStore";

export interface Props {
  title: string;
}

const { title } = Astro.props;
const t = useTranslations();
---

<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <meta name="description" content={t.siteDescription} />
    <title>{title}</title>
  </head>
  <body class="bg-gray-50 dark:bg-gray-900 transition-colors duration-200">
    <slot />
    <script is:inline>
      // Sistema de traducciones del lado del cliente
      const translations = {
        es: {
          mainTitle: "Urgències Hospital de Dénia",
          mainSubtitle:
            "Formación especializada para profesionales de la salud",
          siteDescription:
            "Formación especializada para profesionales de la salud en Urgències Hospital de Dénia",

          viewCoursesButton: "Ver cursos disponibles",
          enrollButton: "Inscribirme",

          sections: {
            rcp: {
              title: "Sección RCP",
              description: "Cursos de Reanimación Cardiopulmonar",
            },
            acreditados: {
              title: "Talleres Acreditados",
              description: "Talleres con certificación oficial",
            },
            talleres: {
              title: "Talleres Específicos",
              description: "Talleres especializados por áreas",
            },
            enfermeria: {
              title: "Enfermería",
              description:
                "Formación específica para profesionales de enfermería",
            },
            info: {
              title: "Información General",
              description: "Documentos y recursos informativos",
            },
          },

          generalInfo: {
            title: "Información General",
            welcome:
              "Bienvenido a nuestra plataforma de cursos de formación médica. Ofrecemos una amplia gama de programas formativos diseñados para profesionales de la salud, desde cursos básicos de RCP hasta talleres especializados acreditados.",
            features: [
              "Formación impartida por profesionales cualificados",
              "Certificaciones oficiales reconocidas",
              "Metodología práctica y actualizada",
              "Grupos reducidos para mejor aprendizaje",
            ],
            contact:
              "Para más información sobre nuestros cursos, no dudes en contactarnos.",
          },

          noCourses: "No hay cursos disponibles en este momento.",

          courseCount: {
            singular: "curso",
            plural: "cursos",
          },

          courseLabels: {
            title: "Curso",
            for: "Dirigido a:",
            date: "Fecha:",
          },
        },

        va: {
          mainTitle: "Urgències Hospital de Dénia",
          mainSubtitle:
            "Formació especialitzada per a professionals de la salut",
          siteDescription:
            "Formació especialitzada per a professionals de la salut en Urgències Hospital de Dénia",

          viewCoursesButton: "Veure cursos disponibles",
          enrollButton: "Inscriure'm",

          sections: {
            rcp: {
              title: "Secció RCP",
              description: "Cursos de Reanimació Cardiopulmonar",
            },
            acreditados: {
              title: "Tallers Acreditats",
              description: "Tallers amb certificació oficial",
            },
            talleres: {
              title: "Tallers Específics",
              description: "Tallers especialitzats per àrees",
            },
            enfermeria: {
              title: "Infermeria",
              description:
                "Formació específica per a professionals d'infermeria",
            },
            info: {
              title: "Informació General",
              description: "Documents i recursos informatius",
            },
          },

          generalInfo: {
            title: "Informació General",
            welcome:
              "Benvingut a la nostra plataforma de cursos de formació mèdica. Oferim una àmplia gamma de programes formatius dissenyats per a professionals de la salut, des de cursos bàsics de RCP fins a tallers especialitzats acreditats.",
            features: [
              "Formació impartida per professionals qualificats",
              "Certificacions oficials reconegudes",
              "Metodologia pràctica i actualitzada",
              "Grups reduïts per a millor aprenentatge",
            ],
            contact:
              "Per a més informació sobre els nostres cursos, no dubtes en contactar-nos.",
          },

          noCourses: "No hi ha cursos disponibles en aquest moment.",

          courseCount: {
            singular: "curs",
            plural: "cursos",
          },

          courseLabels: {
            title: "Curs",
            for: "Dirigit a:",
            date: "Data:",
          },
        },
      };

      class I18nClient {
        constructor() {
          this.currentLanguage = this.getStoredLanguage();
          this.init();
        }

        getStoredLanguage() {
          return localStorage.getItem("language") || "es";
        }

        setLanguage(lang) {
          console.log("Cambiando idioma a:", lang);
          this.currentLanguage = lang;
          localStorage.setItem("language", lang);
          this.updateUI();
          console.log("Idioma cambiado y UI actualizada");
        }

        toggleLanguage() {
          const newLang = this.currentLanguage === "es" ? "va" : "es";
          this.setLanguage(newLang);
        }

        getTranslation(key) {
          const keys = key.split(".");
          let value = translations[this.currentLanguage];

          for (const k of keys) {
            value = value?.[k];
          }

          return value || key;
        }

        updateUI() {
          console.log("Actualizando UI con idioma:", this.currentLanguage);

          // Actualizar elementos con data-i18n
          const elements = document.querySelectorAll("[data-i18n]");
          console.log("Elementos encontrados con data-i18n:", elements.length);

          elements.forEach((element) => {
            const key = element.getAttribute("data-i18n");
            const translation = this.getTranslation(key);

            if (translation) {
              console.log(`Traduciendo ${key}:`, translation);
              element.textContent = translation;
            }
          });

          // Actualizar las features de información general
          this.updateInfoFeatures();

          // Actualizar elementos específicos del sidebar
          this.updateSidebar();

          // Actualizar contadores de cursos
          this.updateCourseCounts();

          // Actualizar el indicador de idioma actual
          const currentLangElement = document.getElementById("current-lang");
          if (currentLangElement) {
            currentLangElement.textContent = this.currentLanguage.toUpperCase();
          }

          // Actualizar meta description
          const metaDescription = document.querySelector(
            'meta[name="description"]'
          );
          if (metaDescription) {
            metaDescription.setAttribute(
              "content",
              this.getTranslation("siteDescription")
            );
          }

          // Actualizar title
          const titleElement = document.querySelector("title");
          if (titleElement) {
            titleElement.textContent = `Cursos de Formación - ${this.getTranslation("mainTitle")}`;
          }
        }

        updateInfoFeatures() {
          const featuresContainer = document.getElementById("info-features");
          if (featuresContainer) {
            const features = this.getTranslation("generalInfo.features");
            if (Array.isArray(features)) {
              featuresContainer.innerHTML = features
                .map((feature) => `<li>${feature}</li>`)
                .join("");
            }
          }
        }

        updateSidebar() {
          // Actualizar títulos del sidebar
          const sidebarButtons =
            document.querySelectorAll("[data-section-key]");
          sidebarButtons.forEach((button) => {
            const sectionKey = button.getAttribute("data-section-key");
            const titleElement = button.querySelector(".section-title");
            if (titleElement && sectionKey) {
              titleElement.textContent = this.getTranslation(
                `sections.${sectionKey}.title`
              );
            }
          });
        }

        updateCourseCounts() {
          // Actualizar contadores de cursos
          document
            .querySelectorAll("[data-course-count]")
            .forEach((element) => {
              const count = parseInt(element.getAttribute("data-course-count"));
              const countText =
                count === 1
                  ? this.getTranslation("courseCount.singular")
                  : this.getTranslation("courseCount.plural");
              element.textContent = `${count} ${countText}`;
            });

          // Actualizar mensajes de "no hay cursos"
          document
            .querySelectorAll('[data-i18n="noCourses"]')
            .forEach((element) => {
              element.textContent = this.getTranslation("noCourses");
            });
        }

        init() {
          // Si el DOM ya está listo, aplicar traducciones inmediatamente
          if (document.readyState === "loading") {
            document.addEventListener("DOMContentLoaded", () => {
              this.updateUI();
            });
          } else {
            // DOM ya está listo, aplicar inmediatamente
            this.updateUI();
          }
        }
      }

      // Inicializar el sistema de internacionalización
      window.i18n = new I18nClient();
    </script>
  </body>
</html>
